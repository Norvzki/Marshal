<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Study Mode Active - Marshal</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: url('/public/forest-background.png') center/cover fixed;
      background-attachment: fixed;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: white;
      padding: 20px;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(4px);
      z-index: 1;
    }

    .container {
      position: relative;
      z-index: 2;
      max-width: 500px;
      width: 100%;
      animation: slideUpIn 0.6s ease-out;
    }

    @keyframes slideUpIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header-badge {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      background: rgba(255, 255, 255, 0.95);
      padding: 12px 24px;
      border-radius: 50px;
      margin: 0 auto 24px;
      width: fit-content;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    }

    .header-badge img {
      width: 24px;
      height: 24px;
    }

    .header-badge-text {
      font-weight: 700;
      color: #d91e63;
      font-size: 16px;
    }

    .main-card {
      background: rgba(255, 255, 255, 0.12);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 32px;
      padding: 40px 32px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      text-align: center;
    }

    .title {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 12px;
      background: linear-gradient(135deg, #ffffff 0%, #e0f2fe 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 28px;
      line-height: 1.5;
    }

    .quote-box {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 20px;
      padding: 24px;
      margin: 28px 0;
      font-style: italic;
      font-size: 16px;
      line-height: 1.6;
      color: rgba(255, 255, 255, 0.95);
    }

    .stats-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin: 28px 0;
    }

    .stat-box {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 16px;
      padding: 20px;
      backdrop-filter: blur(10px);
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      display: block;
      margin-bottom: 8px;
      color: #ffffff;
    }

    .stat-label {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.7);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }

    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 32px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .btn {
      flex: 1;
      min-width: 140px;
      padding: 14px 24px;
      border: none;
      border-radius: 24px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-analytics {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
    }

    .btn-marshall {
      background: linear-gradient(135deg, #d91e63 0%, #c2185b 100%);
      color: white;
    }
  </style>
</head>
<body>
  <div class="overlay"></div>
  
  <div class="container">
    <div class="header-badge">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2L8 6H4V10L2 12L4 14V18H8L12 22L16 18H20V14L22 12L20 10V6H16L12 2Z" fill="url(%23gradient)" stroke="%23d91e63" stroke-width="1"/>
      </svg>
      <span class="header-badge-text">Marshal</span>
    </div>

    <div class="main-card">
      <h1 class="title">Study Mode Active</h1>
      <p class="subtitle">This website is currently blocked by Marshal.<br>You can change this in the Study Mode Tab.</p>

      <div class="quote-box" id="dailyQuote">
        "The secret of getting ahead is getting started."
      </div>

      <div class="stats-container">
        <div class="stat-box">
          <span class="stat-value" id="timeSavedStat">0h</span>
          <span class="stat-label">Time Saved</span>
        </div>
        <div class="stat-box">
          <span class="stat-value" id="blocksMadeStat">0</span>
          <span class="stat-label">Blocks Made</span>
        </div>
      </div>

      <div class="button-group">
        <button class="btn btn-analytics" id="viewAnalyticsBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 13h2v8H3zm4-8h2v16H7zm4-2h2v18h-2zm4-2h2v20h-2zm4 4h2v16h-2z" fill="currentColor"/>
          </svg>
          <span>View Analytics</span>
        </button>
        <button class="btn btn-marshall" id="openMarshalBtn">
          <span>ðŸ“–</span>
          <span>Open Marshal</span>
        </button>
      </div>
    </div>
  </div>

  <script>
    async function loadDailyQuote() {
      try {
        const response = await fetch(chrome.runtime.getURL('quotes.json'))
        const data = await response.json()
        const quotes = data.quotes

        const now = new Date()
        const start = new Date(now.getFullYear(), 0, 0)
        const diff = now - start
        const oneDay = 1000 * 60 * 60 * 24
        const dayOfYear = Math.floor(diff / oneDay)

        const quoteIndex = dayOfYear % quotes.length
        document.getElementById('dailyQuote').textContent = `"${quotes[quoteIndex]}"`
      } catch (error) {
        console.error('Error loading quote:', error)
      }
    }

    function loadStats() {
      chrome.storage.local.get([
        'dailyBlockedAttempts',
        'totalTimeSaved'
      ], (result) => {
        const attempts = result.dailyBlockedAttempts || 0
        const timeSavedMinutes = result.totalTimeSaved || 0

        const hours = Math.floor(timeSavedMinutes / 60)
        const minutes = timeSavedMinutes % 60
        let timeDisplay = ''
        if (hours > 0) {
          timeDisplay = `${hours}h ${minutes}m`
        } else if (minutes > 0) {
          timeDisplay = `${minutes}m`
        } else {
          timeDisplay = '0m'
        }

        document.getElementById('timeSavedStat').textContent = timeDisplay
        document.getElementById('blocksMadeStat').textContent = attempts
        
        console.log("[v0] Stats loaded - Attempts:", attempts, "Time Saved:", timeSavedMinutes, "Display:", timeDisplay)
      })
    }

    document.getElementById('viewAnalyticsBtn').addEventListener('click', () => {
      console.log("[v0] View Analytics clicked")
      chrome.runtime.sendMessage({ action: 'openPopup' }, (response) => {
        console.log("[v0] Popup opened, response:", response)
        setTimeout(() => {
          chrome.runtime.sendMessage({ action: 'showPage', page: 'focusModeStatsPage' }, (response) => {
            console.log("[v0] Stats page shown, response:", response)
          })
        }, 500)
      })
    })

    document.getElementById('openMarshalBtn').addEventListener('click', () => {
      console.log("[v0] Open Marshal clicked")
      chrome.runtime.sendMessage({ action: 'openPopup' }, (response) => {
        console.log("[v0] Popup opened, response:", response)
      })
    })

    // Initialize on page load
    loadDailyQuote()
    loadStats()
    setInterval(loadStats, 1000)
  </script>
</body>
</html>
